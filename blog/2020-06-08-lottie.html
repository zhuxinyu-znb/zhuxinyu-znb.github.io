<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>lottie原理探索 | zxy的前端日志</title>
    <meta name="description" content="大前端之路开启">
    <link rel="icon" href="/tom.jpg">
    
    <link rel="preload" href="/assets/css/0.styles.0cbbf90a.css" as="style"><link rel="preload" href="/assets/js/app.4d237ac1.js" as="script"><link rel="preload" href="/assets/js/2.a060ff2c.js" as="script"><link rel="preload" href="/assets/js/88.0763a6b6.js" as="script"><link rel="prefetch" href="/assets/js/10.9b1783bd.js"><link rel="prefetch" href="/assets/js/100.f2ba88c1.js"><link rel="prefetch" href="/assets/js/101.5e4ff941.js"><link rel="prefetch" href="/assets/js/102.3b9faf71.js"><link rel="prefetch" href="/assets/js/103.ef114a14.js"><link rel="prefetch" href="/assets/js/104.038f45d3.js"><link rel="prefetch" href="/assets/js/105.5b457551.js"><link rel="prefetch" href="/assets/js/106.c1138d30.js"><link rel="prefetch" href="/assets/js/107.52f38a92.js"><link rel="prefetch" href="/assets/js/108.a794593b.js"><link rel="prefetch" href="/assets/js/109.18b69319.js"><link rel="prefetch" href="/assets/js/11.9c1e82ab.js"><link rel="prefetch" href="/assets/js/110.2261fb1b.js"><link rel="prefetch" href="/assets/js/111.00ccfb14.js"><link rel="prefetch" href="/assets/js/112.a9104a88.js"><link rel="prefetch" href="/assets/js/113.9f3a8f8a.js"><link rel="prefetch" href="/assets/js/114.206ecfeb.js"><link rel="prefetch" href="/assets/js/115.5745e2df.js"><link rel="prefetch" href="/assets/js/116.c1f7447b.js"><link rel="prefetch" href="/assets/js/117.9e065728.js"><link rel="prefetch" href="/assets/js/118.0f2d3691.js"><link rel="prefetch" href="/assets/js/119.6bea2203.js"><link rel="prefetch" href="/assets/js/12.67149a6a.js"><link rel="prefetch" href="/assets/js/120.32450f30.js"><link rel="prefetch" href="/assets/js/121.fee9f710.js"><link rel="prefetch" href="/assets/js/122.def18904.js"><link rel="prefetch" href="/assets/js/123.25039dca.js"><link rel="prefetch" href="/assets/js/124.c4050122.js"><link rel="prefetch" href="/assets/js/125.46b40dfe.js"><link rel="prefetch" href="/assets/js/126.51a1a5d8.js"><link rel="prefetch" href="/assets/js/127.7867f500.js"><link rel="prefetch" href="/assets/js/128.49de406e.js"><link rel="prefetch" href="/assets/js/129.cdf49571.js"><link rel="prefetch" href="/assets/js/13.fb79cecf.js"><link rel="prefetch" href="/assets/js/130.8b3710bf.js"><link rel="prefetch" href="/assets/js/131.36dfdd90.js"><link rel="prefetch" href="/assets/js/132.e44f7288.js"><link rel="prefetch" href="/assets/js/133.ec885b28.js"><link rel="prefetch" href="/assets/js/134.f1316579.js"><link rel="prefetch" href="/assets/js/135.ecf5779f.js"><link rel="prefetch" href="/assets/js/136.996ceb08.js"><link rel="prefetch" href="/assets/js/137.0b240ef8.js"><link rel="prefetch" href="/assets/js/138.de8c92b0.js"><link rel="prefetch" href="/assets/js/139.aa2176ad.js"><link rel="prefetch" href="/assets/js/14.7f7c1b73.js"><link rel="prefetch" href="/assets/js/140.5e8ac77c.js"><link rel="prefetch" href="/assets/js/141.abbc86d6.js"><link rel="prefetch" href="/assets/js/142.9174e4b3.js"><link rel="prefetch" href="/assets/js/143.22fd8bba.js"><link rel="prefetch" href="/assets/js/144.aed38b7d.js"><link rel="prefetch" href="/assets/js/145.a6813681.js"><link rel="prefetch" href="/assets/js/146.41a80028.js"><link rel="prefetch" href="/assets/js/147.ba1a7770.js"><link rel="prefetch" href="/assets/js/148.877bea00.js"><link rel="prefetch" href="/assets/js/149.27096d07.js"><link rel="prefetch" href="/assets/js/15.fbb3ce6c.js"><link rel="prefetch" href="/assets/js/150.4eb384a9.js"><link rel="prefetch" href="/assets/js/151.528f4deb.js"><link rel="prefetch" href="/assets/js/152.192e9a1f.js"><link rel="prefetch" href="/assets/js/153.a3b71eb6.js"><link rel="prefetch" href="/assets/js/154.df79b8cb.js"><link rel="prefetch" href="/assets/js/155.aec97f81.js"><link rel="prefetch" href="/assets/js/16.03657715.js"><link rel="prefetch" href="/assets/js/17.20cbf2da.js"><link rel="prefetch" href="/assets/js/18.12a5dc5c.js"><link rel="prefetch" href="/assets/js/19.726a67f7.js"><link rel="prefetch" href="/assets/js/20.836a5d40.js"><link rel="prefetch" href="/assets/js/21.c951da6e.js"><link rel="prefetch" href="/assets/js/22.87c90120.js"><link rel="prefetch" href="/assets/js/23.99c7dbfb.js"><link rel="prefetch" href="/assets/js/24.d8c6d636.js"><link rel="prefetch" href="/assets/js/25.bb1086c1.js"><link rel="prefetch" href="/assets/js/26.31634d99.js"><link rel="prefetch" href="/assets/js/27.2fb85e0f.js"><link rel="prefetch" href="/assets/js/28.696d685c.js"><link rel="prefetch" href="/assets/js/29.488210dd.js"><link rel="prefetch" href="/assets/js/3.78e42548.js"><link rel="prefetch" href="/assets/js/30.2ba4ba04.js"><link rel="prefetch" href="/assets/js/31.d141acc1.js"><link rel="prefetch" href="/assets/js/32.086dce6f.js"><link rel="prefetch" href="/assets/js/33.ed1968ff.js"><link rel="prefetch" href="/assets/js/34.77827aa7.js"><link rel="prefetch" href="/assets/js/35.d5b914d6.js"><link rel="prefetch" href="/assets/js/36.f9397b07.js"><link rel="prefetch" href="/assets/js/37.64beee5f.js"><link rel="prefetch" href="/assets/js/38.67130674.js"><link rel="prefetch" href="/assets/js/39.de9f3702.js"><link rel="prefetch" href="/assets/js/4.5197eef5.js"><link rel="prefetch" href="/assets/js/40.f23dcf4c.js"><link rel="prefetch" href="/assets/js/41.b6418c92.js"><link rel="prefetch" href="/assets/js/42.75dabff5.js"><link rel="prefetch" href="/assets/js/43.7e1d7e20.js"><link rel="prefetch" href="/assets/js/44.53712706.js"><link rel="prefetch" href="/assets/js/45.dafdeeff.js"><link rel="prefetch" href="/assets/js/46.66f32e9c.js"><link rel="prefetch" href="/assets/js/47.23958449.js"><link rel="prefetch" href="/assets/js/48.f4ec7b60.js"><link rel="prefetch" href="/assets/js/49.518f1bec.js"><link rel="prefetch" href="/assets/js/5.b26139fb.js"><link rel="prefetch" href="/assets/js/50.c8e8fb43.js"><link rel="prefetch" href="/assets/js/51.5f15d9c7.js"><link rel="prefetch" href="/assets/js/52.4db4cdfb.js"><link rel="prefetch" href="/assets/js/53.6af7b618.js"><link rel="prefetch" href="/assets/js/54.fec88fbe.js"><link rel="prefetch" href="/assets/js/55.a7e02100.js"><link rel="prefetch" href="/assets/js/56.67d70446.js"><link rel="prefetch" href="/assets/js/57.4866ef69.js"><link rel="prefetch" href="/assets/js/58.e6488e01.js"><link rel="prefetch" href="/assets/js/59.2467dc1e.js"><link rel="prefetch" href="/assets/js/6.b88b0bec.js"><link rel="prefetch" href="/assets/js/60.a4188798.js"><link rel="prefetch" href="/assets/js/61.b275a457.js"><link rel="prefetch" href="/assets/js/62.d6b63240.js"><link rel="prefetch" href="/assets/js/63.681f3d8b.js"><link rel="prefetch" href="/assets/js/64.9eeded5a.js"><link rel="prefetch" href="/assets/js/65.19721dd4.js"><link rel="prefetch" href="/assets/js/66.038614c3.js"><link rel="prefetch" href="/assets/js/67.d802f033.js"><link rel="prefetch" href="/assets/js/68.ce021a23.js"><link rel="prefetch" href="/assets/js/69.7ceca11e.js"><link rel="prefetch" href="/assets/js/7.0d983d99.js"><link rel="prefetch" href="/assets/js/70.f997d037.js"><link rel="prefetch" href="/assets/js/71.c1557031.js"><link rel="prefetch" href="/assets/js/72.2d9f5c4e.js"><link rel="prefetch" href="/assets/js/73.11ad7e38.js"><link rel="prefetch" href="/assets/js/74.eab8f5c6.js"><link rel="prefetch" href="/assets/js/75.e9fb6786.js"><link rel="prefetch" href="/assets/js/76.abdc4f64.js"><link rel="prefetch" href="/assets/js/77.dc44de72.js"><link rel="prefetch" href="/assets/js/78.ebf803d8.js"><link rel="prefetch" href="/assets/js/79.3228bce2.js"><link rel="prefetch" href="/assets/js/8.8a23a928.js"><link rel="prefetch" href="/assets/js/80.8c3fdc1e.js"><link rel="prefetch" href="/assets/js/81.f1472a60.js"><link rel="prefetch" href="/assets/js/82.95875586.js"><link rel="prefetch" href="/assets/js/83.6bfbbc19.js"><link rel="prefetch" href="/assets/js/84.91ade6f8.js"><link rel="prefetch" href="/assets/js/85.b5fdbf72.js"><link rel="prefetch" href="/assets/js/86.9d1404c5.js"><link rel="prefetch" href="/assets/js/87.0567def1.js"><link rel="prefetch" href="/assets/js/89.b76800ed.js"><link rel="prefetch" href="/assets/js/9.11df2484.js"><link rel="prefetch" href="/assets/js/90.e9371a29.js"><link rel="prefetch" href="/assets/js/91.3abf758b.js"><link rel="prefetch" href="/assets/js/92.49121cc0.js"><link rel="prefetch" href="/assets/js/93.e7b2f6cc.js"><link rel="prefetch" href="/assets/js/94.c3307a0b.js"><link rel="prefetch" href="/assets/js/95.90dfe36e.js"><link rel="prefetch" href="/assets/js/96.4df4988a.js"><link rel="prefetch" href="/assets/js/97.60b1c42f.js"><link rel="prefetch" href="/assets/js/98.6394b8d8.js"><link rel="prefetch" href="/assets/js/99.98be11a9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0cbbf90a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">zxy的前端日志</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><a href="/interview/" class="nav-link">面试题</a></div><div class="nav-item"><a href="/book/" class="nav-link">阅读</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><a href="/interview/" class="nav-link">面试题</a></div><div class="nav-item"><a href="/book/" class="nav-link">阅读</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>PHP</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/2019-05-28-php.html" class="sidebar-link">PHP学习(一) 基础语法</a></li><li><a href="/blog/2019-06-05-php&amp;mysql.html" class="sidebar-link">PHP学习(二) php与mysql</a></li><li><a href="/blog/2019-06-05-php_OOP_introduction.html" class="sidebar-link">PHP学习(三) php面向对象介绍</a></li><li><a href="/blog/2019-06-05-PHP_construct.html" class="sidebar-link">PHP学习(四) 构造方法和析构方法</a></li><li><a href="/blog/2019-06-10-OOP_fengzhuang.html" class="sidebar-link">PHP学习(五) PHP面向对象之封装性</a></li><li><a href="/blog/2019-06-10-OOP_jicheng_duotai.html" class="sidebar-link">PHP学习(六) PHP面向对象之继承与多态</a></li><li><a href="/blog/2019-06-10-OOP_interface_abstract.html" class="sidebar-link">PHP学习(七) PHP抽象类与接口</a></li><li><a href="/blog/2019-06-11-OPP_error.html" class="sidebar-link">PHP学习(八) PHP异常处理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>node</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/2019-06-25-node.html" class="sidebar-link">Node.js学习(基础)</a></li><li><a href="/blog/2019-06-26-express1.html" class="sidebar-link">express学习(一) express介绍</a></li><li><a href="/blog/2019-06-27-express-middleware.html" class="sidebar-link">express学习(二) 中间件</a></li><li><a href="/blog/2019-06-27-express-router.html" class="sidebar-link">express学习(三) 路由</a></li><li><a href="/blog/2019-06-27-express-error.html" class="sidebar-link">express学习(四) 错误处理</a></li><li><a href="/blog/2019-08-19-node.html" class="sidebar-link">大规模NodeJS项目架构与优化</a></li><li><a href="/blog/2019-08-20-node-pachong.html" class="sidebar-link">爬虫</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工程化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/2019-06-27-qa.html" class="sidebar-link">Javascript与QA工程师(一)</a></li><li><a href="/blog/2019-08-04-QA.html" class="sidebar-link">Javascript与QA工程师(二)</a></li><li><a href="/blog/2019-07-05-webpack1.html" class="sidebar-link">webpack4(一) webpack的核心概念</a></li><li><a href="/blog/2019-07-05-webpack2.html" class="sidebar-link">webpack4(二) webpack的高级概念</a></li><li><a href="/blog/2019-07-09-webpack3.html" class="sidebar-link">webpack4(三) webpack实战配置</a></li><li><a href="/blog/2019-07-10-webpack4.html" class="sidebar-link">webpack4(四) webpack底层原理及脚手架工具分析</a></li><li><a href="/blog/2019-08-28-gongchenghua1.html" class="sidebar-link">前端工程化Linux预备知识</a></li><li><a href="/blog/2019-08-29-jenkins.html" class="sidebar-link">前端工程化之CI&amp;CD --jenkins</a></li><li><a href="/blog/2019-09-02-chixujicheng.html" class="sidebar-link">从0到大论前端持续集成</a></li><li><a href="/blog/2019-09-02-mycli.html" class="sidebar-link">手写一个自己的cli</a></li><li><a href="/blog/2019-09-04-gulp.html" class="sidebar-link">构建工具</a></li><li><a href="/blog/2019-10-17-rongcuo.html" class="sidebar-link">容错</a></li><li><a href="/blog/2019-11-14-docker.html" class="sidebar-link">微服务入门与Docker实战</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>性能优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/2019-09-11-xingnengyouhua.html" class="sidebar-link">前端性能优化 服务器</a></li><li><a href="/blog/2019-09-12-yahujungui.html" class="sidebar-link">雅虎军规</a></li><li><a href="/blog/2019-09-16-xingnengyouhua.html" class="sidebar-link">前端架构与性能优化那些事儿</a></li><li><a href="/blog/2019-12-12-webpack.html" class="sidebar-link">webpack 性能优化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/2019-10-09-css-workflow.html" class="sidebar-link">现代化css方法论 CSS WorkFlow</a></li><li><a href="/blog/2019-10-10-css-hodini.html" class="sidebar-link">CSS魔术师Houdini</a></li><li><a href="/blog/2019-11-18-flex-css.html" class="sidebar-link">flex布局</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>js基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/2019-12-02-es6-Map.html" class="sidebar-link">Set 和 Map</a></li><li><a href="/blog/2019-12-10-jicheng.html" class="sidebar-link">继承</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>编程基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/2019-07-31-fp-.html" class="sidebar-link">函数式编程</a></li><li><a href="/blog/2019-10-20-sixiang.html" class="sidebar-link">面向切面的编程思想</a></li><li><a href="/blog/2020-01-05-shejimoshi.html" class="sidebar-link">设计模式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Linux</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/2019-05-27-Linux-instructions.html" class="sidebar-link">Linux常用指令</a></li><li><a href="/blog/2019-07-31-linux.html" class="sidebar-link">Linux预读</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器网络协议</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/2019-08-14-http1.html" class="sidebar-link">HTTP协议那些事(一)</a></li><li><a href="/blog/2019-08-15-http2.html" class="sidebar-link">HTTP协议那些事(二)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数据结构与算法</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/2019-12-06-data.html" class="sidebar-link">基础数据结构</a></li><li><a href="/blog/2019-12-04-sort.html" class="sidebar-link">排序算法</a></li><li><a href="/blog/2019-12-10-suanfa.html" class="sidebar-link">算法概论</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>图形学</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/2019-12-15-canvas.html" class="sidebar-link">canvas 2d 入门</a></li><li><a href="/blog/2019-12-15-3d入门.html" class="sidebar-link">3D图形学入门</a></li><li><a href="/blog/2019-12-15-webgl1.html" class="sidebar-link">WebGL 概述</a></li><li><a href="/blog/2019-12-15-webgl入门.html" class="sidebar-link">WebGL 入门</a></li><li><a href="/blog/2020-09-16-three1.html" class="sidebar-link">threejs 入门（一）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>electron</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/2020-01-31-electron.html" class="sidebar-link">electron学习(一) 基础概念</a></li><li><a href="/blog/2020-02-01-electron.html" class="sidebar-link">electron学习(二) 环境配置</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>tensorflow</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/2020-02-04-tensorflow.html" class="sidebar-link">神经网络</a></li><li><a href="/blog/2020-02-05-tensorflow.html" class="sidebar-link">线性回归任务</a></li><li><a href="/blog/2020-02-05-tensorflow2.html" class="sidebar-link">归一化任务</a></li><li><a href="/blog/2020-02-06-tensorflow.html" class="sidebar-link">逻辑回归任务</a></li><li><a href="/blog/2020-02-06-tensorflow2.html" class="sidebar-link">多层神经网络任务</a></li><li><a href="/blog/2020-02-07-tensorflow.html" class="sidebar-link">多分类任务</a></li><li><a href="/blog/2020-02-07-tensorflow2.html" class="sidebar-link">欠拟合与过拟合任务</a></li><li><a href="/blog/2020-02-08-tensorflow.html" class="sidebar-link">使用卷积神经网络识别手写数字任务</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>源码解读</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/2019-11-13-yuanmadu.html" class="sidebar-link">如何阅读源码</a></li><li><a href="/blog/react源码1.html" class="sidebar-link">React 源码解读（一）JSX</a></li><li><a href="/blog/react源码2.html" class="sidebar-link">React 源码解读（二） Fiber Root</a></li><li><a href="/blog/react源码3.html" class="sidebar-link">React 源码解读（三） requestWork</a></li><li><a href="/blog/react源码4.html" class="sidebar-link">React 源码解读（四） setState</a></li><li><a href="/blog/react源码5.html" class="sidebar-link">React 源码解读（五） hooks</a></li><li><a href="/blog/react源码6.html" class="sidebar-link">React 源码解读（六） hooks 原理（useState）</a></li><li><a href="/blog/2019-12-13-diff.html" class="sidebar-link">手写 Dom dff</a></li><li><a href="/blog/2019-11-27-webpack.html" class="sidebar-link">webpack源码（一）</a></li><li><a href="/blog/2019-12-01-webpack.html" class="sidebar-link">webpack源码（二）</a></li><li><a href="/blog/2019-12-04-koa.html" class="sidebar-link">手写 Koa</a></li><li><a href="/blog/2019-12-24-create-react-app.html" class="sidebar-link">create-react-app 源码分析</a></li><li><a href="/blog/2020-06-08-lottie.html" class="active sidebar-link">lottie原理探索</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/2020-06-08-lottie.html#什么是lottie" class="sidebar-link">什么是Lottie</a></li><li class="sidebar-sub-header"><a href="/blog/2020-06-08-lottie.html#lottie-web使用方法" class="sidebar-link">Lottie-web使用方法</a></li><li class="sidebar-sub-header"><a href="/blog/2020-06-08-lottie.html#源码摸索" class="sidebar-link">源码摸索</a></li><li class="sidebar-sub-header"><a href="/blog/2020-06-08-lottie.html#数据结构" class="sidebar-link">数据结构</a></li><li class="sidebar-sub-header"><a href="/blog/2020-06-08-lottie.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/blog/2020-06-30-vue源码.html" class="sidebar-link">Vue2源码解析</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>实战</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/webpack-0-1.html" class="sidebar-link">实战（一） webpack 环境搭建</a></li><li><a href="/blog/2019-11-18-react.html" class="sidebar-link">实战（二）react-hooks、路由</a></li><li><a href="/blog/2019-11-14-node.html" class="sidebar-link">实战（三） node中间层</a></li><li><a href="/blog/2019-11-22-gulp.html" class="sidebar-link">实战（四） gulp 流清洗</a></li><li><a href="/blog/2019-08-25-bff-shizhan.html" class="sidebar-link">BFF实战</a></li><li><a href="/blog/2019-09-07-webpack-shizhan.html" class="sidebar-link">工程化实战</a></li><li><a href="/blog/2019-10-10-xingnengyouhua-shizhan.html" class="sidebar-link">性能优化实战</a></li><li><a href="/blog/2019-10-14-xingnengyouhua-shizhan2.html" class="sidebar-link">性能优化实战(二)</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="lottie原理探索"><a href="#lottie原理探索" class="header-anchor">#</a> lottie原理探索</h1> <h2 id="什么是lottie"><a href="#什么是lottie" class="header-anchor">#</a> 什么是Lottie</h2> <p>Lottie 是 Airbnb 开源的一个动画渲染库，它可以解析 Adobe After Effects 使用 Bodymovin 插件把做的动画导出的 json 文件，并在 Android/iOS、React Native 和 web 端实现相同的动画效果。</p> <p>简单讲就是UI同学使用AE作出好看的特效，再通过Bodymovin插件转成json文件，我们通过对应的库（前端使用lottie-web）将文件解析并展示。</p> <h3 id="lottie优点"><a href="#lottie优点" class="header-anchor">#</a> lottie优点</h3> <p>动画由UI同学使用AE实现，动画的实现更加方便，效果也更好</p> <p>前端可以直接调用动画，并对动画进行控制，减少前端直接写动画的工作量</p> <p>视觉效果提升明显，从以前的简单动效到支持复杂动态</p> <p>文件大小相比较于gif缩小60%-90%，CPU占用率也大幅降低</p> <h3 id="lottie缺点"><a href="#lottie缺点" class="header-anchor">#</a> lottie缺点</h3> <p>lottie-web 文件本身比较大，大小为513k，轻量版压缩后也有144k，经过gzip后，大小为39k</p> <p>使用的json文件是由AE导出，如果UI在设计的时候创建了很多图层，可能会导致json文件较大</p> <p>有部分AE动画的效果还不支持，lottie无法实现</p> <h2 id="lottie-web使用方法"><a href="#lottie-web使用方法" class="header-anchor">#</a> Lottie-web使用方法</h2> <p>直接使用 npm 引入，创建lottie实例</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> lottie <span class="token keyword">from</span> <span class="token string">'lottie-web'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> animation <span class="token operator">=</span> lottie<span class="token punctuation">.</span><span class="token function">loadAnimation</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  container<span class="token punctuation">:</span> element<span class="token punctuation">,</span> <span class="token comment">// document.getElementById(&quot;app&quot;) 容器</span>
  renderer<span class="token punctuation">:</span> <span class="token string">'svg'</span><span class="token punctuation">,</span> <span class="token comment">// 渲染方式 可以选择 svg/canvas/html</span>
  loop<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 循环播放</span>
  autoplay<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 自动播放</span>
  path<span class="token punctuation">:</span> <span class="token string">'data.json'</span> <span class="token comment">// 读取动画json的路径，可以是CDN地址</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>lottie-web 提供了很多操控动画的方法，可以根据需要对动画进行控制</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>animation<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 播放该动画，从目前停止的帧开始播放</span>
animation<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 停止播放该动画，回到第0帧</span>
animation<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 暂停该动画，在当前帧停止并保持</span>

animation<span class="token punctuation">.</span><span class="token function">goToAndStop</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> isFrame<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 跳到某个时刻/帧并停止。isFrame(默认false)指示value表示帧还是时间(毫秒)</span>
animation<span class="token punctuation">.</span><span class="token function">goToAndPlay</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> isFrame<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 跳到某个时刻/帧并进行播放</span>
animation<span class="token punctuation">.</span><span class="token function">goToAndStop</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 跳转到第30帧并停止</span>
animation<span class="token punctuation">.</span><span class="token function">goToAndPlay</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 跳转到第300毫秒并播放</span>

animation<span class="token punctuation">.</span><span class="token function">playSegments</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> forceFlag<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// arr可以包含两个数字或者两个数字组成的数组，forceFlag表示是否立即强制播放该片段</span>
animation<span class="token punctuation">.</span><span class="token function">playSegments</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 播放完之前的片段，播放10-20帧</span>
animation<span class="token punctuation">.</span><span class="token function">playSegments</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 直接播放0-5帧和10-18帧</span>

animation<span class="token punctuation">.</span><span class="token function">setSpeed</span><span class="token punctuation">(</span>speed<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置播放速度，speed为1表示正常速度</span>
animation<span class="token punctuation">.</span><span class="token function">setDirection</span><span class="token punctuation">(</span>direction<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置播放方向，1表示正向播放，-1表示反向播放</span>
animation<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 删除该动画，移除相应的元素标签等。在unmount的时候，需要调用该方法</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>lottie-web还提供了一些监听事件</p> <ul><li><p>complete: 播放完成（循环播放下不会触发）</p></li> <li><p>loopComplete: 当前循环下播放（循环播放/非循环播放）结束时触发</p></li> <li><p>enterFrame: 每进入一帧就会触发，播放时每一帧都会触发一次，stop方法也会触发</p></li> <li><p>segmentStart: 播放指定片段时触发，playSegments、resetSegments等方法刚开始播放指定片段时会发出，如果playSegments播放多个片段，多个片段最开始都会触发。</p></li> <li><p>data_ready: 动画json文件加载完毕触发</p></li> <li><p>DOMLoaded: 动画相关的dom已经被添加到html后触发</p></li> <li><p>destroy: 将在动画删除时触发</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>animation<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'data_ready'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'animation data has loaded'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="源码摸索"><a href="#源码摸索" class="header-anchor">#</a> 源码摸索</h2> <p>从 <a href="https://github.com/airbnb/lottie-web" target="_blank" rel="noopener noreferrer">git仓库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 将源码clone下来，在player/js 目录下即为播放器代码，module.js 为入口文件，下面以一个文件被加载到播放为例，看看都做了什么工作。</p> <p>入口文件 module.js 进入，定义了 lottie 对象，并将各个模块方法都挂载在对象上，其中 loadAnimation 方法是用来初始化动画的。源码中可以看到，大部分的静态方法被委托到了 animationManager 上。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> lottie <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
<span class="token keyword">function</span> <span class="token function">loadAnimation</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>standalone <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        params<span class="token punctuation">.</span>animationData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>animationData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> animationManager<span class="token punctuation">.</span><span class="token function">loadAnimation</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">...</span>
lottie<span class="token punctuation">.</span>loadAnimation <span class="token operator">=</span> loadAnimation<span class="token punctuation">;</span>
lottie<span class="token punctuation">.</span>play <span class="token operator">=</span> animationManager<span class="token punctuation">.</span>play<span class="token punctuation">;</span>
lottie<span class="token punctuation">.</span>pause <span class="token operator">=</span> animationManager<span class="token punctuation">.</span>pause<span class="token punctuation">;</span>
lottie<span class="token punctuation">.</span>setLocationHref <span class="token operator">=</span> setLocationHref<span class="token punctuation">;</span>
lottie<span class="token punctuation">.</span>togglePause <span class="token operator">=</span> animationManager<span class="token punctuation">.</span>togglePause<span class="token punctuation">;</span>
<span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>下面跟着断点进行调试，看一下具体的执行过程。执行了初始化动画的方法 loadAnimation 之后，返回了 animationManager.loadAnimation，就是我们刚才看到的入口文件中被挂载的静态方法</p> <p>继续向下，进入到源码中的  animation/AnimationManager.js 文件</p> <p>下面就是几个比较重要的方法了，咱们一个一个看</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">loadAnimation</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> animItem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnimationItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 实例化</span>
    <span class="token function">setupAnimation</span><span class="token punctuation">(</span>animItem<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 绑定自定义事件</span>
    animItem<span class="token punctuation">.</span><span class="token function">setParams</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 设置参数</span>
    <span class="token keyword">return</span> animItem<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="setupanimation"><a href="#setupanimation" class="header-anchor">#</a> setupAnimation</h3> <p>首先进行了实例化，AnimationItem 是动画容器的基类， setupAnimation 方法中是一些自定义的事件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">setupAnimation</span><span class="token punctuation">(</span><span class="token parameter">animItem<span class="token punctuation">,</span> element</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        animItem<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'destroy'</span><span class="token punctuation">,</span>removeElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
        animItem<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'_active'</span><span class="token punctuation">,</span>addPlayingCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        animItem<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'_idle'</span><span class="token punctuation">,</span>subtractPlayingCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registeredAnimations<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>elem<span class="token punctuation">:</span> element<span class="token punctuation">,</span>animation<span class="token punctuation">:</span>animItem<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        len <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="setparams"><a href="#setparams" class="header-anchor">#</a> setParams</h3> <p>setParams 是 AnimationItem 实例的一个方法，删掉了一些无关紧要的地方，核心就是两点</p> <ol><li><p><strong>确定渲染方式，并创建相应的渲染器</strong></p></li> <li><p><strong>确定数据源，如果有 animationData 参数就直接用这个数据，如果没有就用 path ，之后会调用 assetLoader.load 来初始化数据，最终数据都被传给了 configAnimation 方法</strong></p></li></ol> <p>demo中使用的是path的方式将文件路径传了进去，所以会执行 assetLoader.load ，assetLoader中主要就是建立了 XML 连接，将 path 中的内容下载下来，在将传入的callback 也就是 configAnimation 执行掉</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">AnimationItem</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">setParams</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token keyword">var</span> animType <span class="token operator">=</span> params<span class="token punctuation">.</span>animType <span class="token operator">?</span> params<span class="token punctuation">.</span>animType <span class="token punctuation">:</span> params<span class="token punctuation">.</span>renderer <span class="token operator">?</span> params<span class="token punctuation">.</span>renderer <span class="token punctuation">:</span> <span class="token string">'svg'</span><span class="token punctuation">;</span>
    <span class="token comment">// 确定渲染方式并创建渲染器</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>animType<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'canvas'</span><span class="token punctuation">:</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CanvasRenderer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span>rendererSettings<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token comment">// demo中使用的是svg方式，所以会进入进行svg渲染器的创建</span>
        <span class="token keyword">case</span> <span class="token string">'svg'</span><span class="token punctuation">:</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SVGRenderer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span>rendererSettings<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HybridRenderer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span>rendererSettings<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
    <span class="token comment">// 判断数据源</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span>animationData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">configAnimation</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>animationData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">{</span>
      	<span class="token comment">// 对path进行处理</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> params<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'\\'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>path <span class="token operator">=</span> params<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>params<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'\\'</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>path <span class="token operator">=</span> params<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>params<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>fileName <span class="token operator">=</span> params<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>fileName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fileName<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>fileName<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'.json'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 初始化path的数据，并传给 configAnimation</span>
        assetLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">configAnimation</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'data_failed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="configanimation"><a href="#configanimation" class="header-anchor">#</a> configAnimation</h3> <p>configAnimation 中会初始化很多动画对象的属性，然后加载各种资源，像图像、字体等，也会去加载预先定义的片段segments（默认有一个），片段是lottie提供的一种动画控制手段，可以将多个动画统一在一个动画对象中，其本质上是不断调用loadNextSegments方法，获取片段路径然后不断调用assetsLoader.load方法去加载新的片段。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">AnimationItem</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">configAnimation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">animData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>animationData <span class="token operator">=</span> animData<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>initialSegment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>totalFrames <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>initialSegment<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>initialSegment<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>firstFrame <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>initialSegment<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>totalFrames <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>animationData<span class="token punctuation">.</span>op <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animationData<span class="token punctuation">.</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>firstFrame <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>animationData<span class="token punctuation">.</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">configAnimation</span><span class="token punctuation">(</span>animData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>animData<span class="token punctuation">.</span>assets<span class="token punctuation">)</span><span class="token punctuation">{</span>
            animData<span class="token punctuation">.</span>assets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>assets <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animationData<span class="token punctuation">.</span>assets<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>frameRate <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animationData<span class="token punctuation">.</span>fr<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>frameMult <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animationData<span class="token punctuation">.</span>fr <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">searchExtraCompositions</span><span class="token punctuation">(</span>animData<span class="token punctuation">.</span>assets<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'config_ready'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">preloadImages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadSegments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updaFrameModifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">waitForFontsLoaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">triggerConfigError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>一切都结束后会将&quot;data_ready&quot;事件触发</p> <p>至此，动画的load的全部结束，动画效果也被渲染出来。然后就会进入一个持续监听的状态，首先进入first，然后进入resume，在 resume 中会计算当前时间和初始化时间的一个diff elapsedTime，之后将 elapsedTime 依次传入所有动画对象的advanceTime方法中，然后更新初始时间并根据状态看是否要进行下一次循环。可见，这里在首帧后lottie做的事情其实就是不断和上一次RAF的时间算diff，并不断利用这个diff去进行下一步操作。</p> <h2 id="数据结构"><a href="#数据结构" class="header-anchor">#</a> 数据结构</h2> <p>lottie要解析的数据结构，可以在线上看 json文件。乍一看内容非常多😳，实际上捋一捋就好了😌</p> <p>Lottie动画Json结构分为4层：</p> <ol><li><p>结构层：可以读取到动画画布的宽高，帧数，背景色，时间，起始关键帧，结束帧等信息。</p></li> <li><p>asset：图片资源信息集合，这里放置的是 制作动画时引用的图片资源。</p></li> <li><p>layers：图层集合，这里可以获取到多少图层，每个图层的开始帧 结束帧等。</p></li> <li><p>shapes：元素集合，可以获取到每个图层都包含多个动画元素。</p></li></ol> <h3 id="最外层json结构层"><a href="#最外层json结构层" class="header-anchor">#</a> 最外层json结构层</h3> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;v&quot;</span><span class="token operator">:</span> <span class="token string">&quot;5.1.13&quot;</span><span class="token punctuation">,</span> <span class="token comment">// bodymovin 版本</span>
    <span class="token property">&quot;fr&quot;</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token comment">// 帧率</span>
    <span class="token property">&quot;ip&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 起始关键帧</span>
    <span class="token property">&quot;op&quot;</span><span class="token operator">:</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token comment">// 结束关键帧</span>
    <span class="token property">&quot;w&quot;</span><span class="token operator">:</span> <span class="token number">710</span><span class="token punctuation">,</span> <span class="token comment">// 视图宽</span>
    <span class="token property">&quot;h&quot;</span><span class="token operator">:</span> <span class="token number">760</span><span class="token punctuation">,</span> <span class="token comment">// 视图高</span>
    <span class="token property">&quot;nm&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test3-13&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 名称</span>
    <span class="token property">&quot;ddd&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 3d</span>
    <span class="token property">&quot;assets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 资源集合 </span>
    <span class="token property">&quot;layers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 图层集合</span>
    <span class="token property">&quot;masker&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 蒙层集合</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>这是最外层的json文件，assets、layers、masker里的内容较多先合起来，看看其他的东西。其中ip表示其实关键帧，一般为0，op表示动画的结束关键帧，fr表示帧率，所以动画时间等于：(op-ip)/fr 。w和h分别表示视图的宽和高。</p> <h3 id="layers层"><a href="#layers层" class="header-anchor">#</a> layers层</h3> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;ddd&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 是否为3d</span>
    <span class="token property">&quot;ind&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// layer的ID，唯一</span>
    <span class="token property">&quot;ty&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 图层类型。</span>
    <span class="token property">&quot;nm&quot;</span><span class="token operator">:</span> <span class="token string">&quot;立即领取&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 图层名称</span>
    <span class="token property">&quot;refId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;comp_0&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 引用的资源，图片/预合成层</span>
    <span class="token property">&quot;sr&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 变换。对应AE中的变换设置，下面有详细介绍</span>
    layer<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 该图层包含的子图层</span>
    shaps<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 形状图层</span>
    <span class="token property">&quot;ao&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;w&quot;</span><span class="token operator">:</span> <span class="token number">1334</span><span class="token punctuation">,</span>
    <span class="token property">&quot;h&quot;</span><span class="token operator">:</span> <span class="token number">750</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ip&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 该图层开始关键帧</span>
    <span class="token property">&quot;op&quot;</span><span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token comment">// 该图层结束关键帧</span>
    <span class="token property">&quot;st&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 该图层</span>
    <span class="token property">&quot;bm&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ul><li><p>nm 表示AE中对应的图层名称</p></li> <li><p>ty 表示类型</p> <ul><li><p>0: comp，合成图层</p></li> <li><p>1: solid;</p></li> <li><p>2: image，图片</p></li> <li><p>3: null;</p></li> <li><p>4: shape，形状图层</p></li> <li><p>5: text，文字</p></li></ul></li></ul> <p>在源码中对layers图层数据相应的处理</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 在player/js/renderers/BaseRenderer.js</span>
<span class="token class-name">BaseRenderer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">buildAllItems</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> i<span class="token punctuation">,</span> len <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>layers<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>len<span class="token punctuation">;</span>i<span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildItem</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkPendingElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">BaseRenderer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">createItem</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">layer</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>layer<span class="token punctuation">.</span>ty<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createImage</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createComp</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createSolid</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createNull</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">4</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createShape</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">5</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createText</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">13</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createCamera</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createNull</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">// 在 player/js/renderers/SVGRenderer.js 中，以svg为例</span>
<span class="token class-name">SVGRenderer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">createNull</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">NullElement</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">SVGRenderer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">createShape</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SVGShapeElement</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">SVGRenderer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">createText</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SVGTextElement</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">SVGRenderer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">createImage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IImageElement</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">SVGRenderer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">createComp</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SVGCompElement</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">SVGRenderer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">createSolid</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ISolidElement</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><h3 id="ks变换"><a href="#ks变换" class="header-anchor">#</a> ks变换</h3> <p>在layers 中，ks是一个非常重要的属性，代表着AE图层中的变换属性。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;ks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 变换。对应AE中的变换设置</span>
    <span class="token property">&quot;o&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 透明度</span>
        <span class="token property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;k&quot;</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        <span class="token property">&quot;ix&quot;</span><span class="token operator">:</span> <span class="token number">11</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;r&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 旋转</span>
        <span class="token property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;k&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;ix&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;p&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 位置</span>
        <span class="token property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;k&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">-167</span><span class="token punctuation">,</span> <span class="token number">358.125</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;ix&quot;</span><span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 锚点</span>
        <span class="token property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;k&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">667</span><span class="token punctuation">,</span> <span class="token number">375</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;ix&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;s&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 缩放</span>
        <span class="token property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;k&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;ix&quot;</span><span class="token operator">:</span> <span class="token number">6</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>lottie-web会把ks处理成transform的属性，用于对元素进行变换操作。transform包含了translate（平移）、scale（缩放）、rotate（旋转）、skew（倾斜）等几种。lottie-web中处理ks（变换）的相关代码在 /player/js/utils/TransformProperty.js，内容比较多就不往上贴了。ks下面又有对应的不同的具体属性，下面是opacity的详细信息。</p> <h4 id="opacity"><a href="#opacity" class="header-anchor">#</a> opacity</h4> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 是否存在关键帧数量</span>
<span class="token property">&quot;k&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>  <span class="token comment">// property value 储存变量的地方</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;i&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 贝塞尔曲线 入值   这里是一个一次函数曲线</span>
      <span class="token property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token number">0.833</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token number">0.833</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;o&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 贝塞尔曲线 出值</span>
      <span class="token property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token number">0.167</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token number">0.167</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;n&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;0p833_0p833_0p167_0p167&quot;</span> <span class="token comment">// 猜测是备注，代码里没用</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;t&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token comment">// 当前关键帧的开始时间</span>
    <span class="token property">&quot;s&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>   <span class="token comment">// 开始的opacity </span>
      <span class="token number">100</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;e&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>   <span class="token comment">// 结束的opacity</span>
      <span class="token number">57</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;t&quot;</span><span class="token operator">:</span> <span class="token number">89.0000036250443</span> <span class="token comment">// 持续的帧数</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token property">&quot;ix&quot;</span><span class="token operator">:</span> <span class="token number">11</span>  <span class="token comment">// propertyIndex 表达式标记 </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="shape层"><a href="#shape层" class="header-anchor">#</a> shape层</h3> <p>shape参数的值对应的是AE中图层的形状设置，用于绘制图形。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;shapes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token property">&quot;ty&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gr&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 类型。混合图层</span>
  <span class="token property">&quot;it&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token comment">// 各图层json</span>
      <span class="token property">&quot;ind&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">&quot;ty&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sh&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 类型，sh表示图形路径</span>
      <span class="token property">&quot;ix&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;ks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token property">&quot;k&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token property">&quot;i&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// 内切线点集合</span>
                  <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token property">&quot;o&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// 外切线点集合</span>
                  <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token property">&quot;v&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// 顶点坐标集合</span>
                  <span class="token punctuation">[</span><span class="token number">182</span><span class="token punctuation">,</span> <span class="token number">-321.75</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">[</span><span class="token number">206.25</span><span class="token punctuation">,</span> <span class="token number">-321.75</span><span class="token punctuation">]</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span> 
              <span class="token property">&quot;c&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// 贝塞尔路径闭合</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">&quot;ix&quot;</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;nm&quot;</span><span class="token operator">:</span> <span class="token string">&quot;路径 1&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;mn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ADBE Vector Shape - Group&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;hd&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token property">&quot;ty&quot;</span><span class="token operator">:</span> <span class="token string">&quot;st&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 类型。图形描边</span>
    <span class="token property">&quot;c&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 线的颜色</span>
        <span class="token property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;k&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;ix&quot;</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;o&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 线的不透明度</span>
        <span class="token property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;k&quot;</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        <span class="token property">&quot;ix&quot;</span><span class="token operator">:</span> <span class="token number">4</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;w&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 线的宽度</span>
        <span class="token property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;k&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">&quot;ix&quot;</span><span class="token operator">:</span> <span class="token number">5</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lc&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 线段的头尾样式</span>
    <span class="token property">&quot;lj&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 线段的连接样式</span>
    <span class="token property">&quot;ml&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">// 尖角限制</span>
    <span class="token property">&quot;nm&quot;</span><span class="token operator">:</span> <span class="token string">&quot;描边 1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;mn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ADBE Vector Graphic - Stroke&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;hd&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><ul><li><p>ty字段表示shape的类型</p></li> <li><p>gr: 图形合并</p></li> <li><p>st: 图形描边</p></li> <li><p>fl: 图形填充</p></li> <li><p>tr: 图形变换</p></li> <li><p>sh: 图形路径</p></li> <li><p>el: 椭圆路径</p></li> <li><p>rc: 矩形路径</p></li> <li><p>tm: 剪裁路径</p></li></ul> <p>/player/js/elements/helpers/shapes/SVGElementsRenderer.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> SVGElementsRenderer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">createRenderFunction</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> ty <span class="token operator">=</span> data<span class="token punctuation">.</span>ty<span class="token punctuation">;</span>
        <span class="token keyword">switch</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>ty<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 根据类型，进行相应的渲染</span>
            <span class="token keyword">case</span> <span class="token string">'fl'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> renderFill<span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">'gf'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> renderGradient<span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">'gs'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> renderGradientStroke<span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">'st'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> renderStroke<span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">'sh'</span><span class="token punctuation">:</span>
            <span class="token keyword">case</span> <span class="token string">'el'</span><span class="token punctuation">:</span>
            <span class="token keyword">case</span> <span class="token string">'rc'</span><span class="token punctuation">:</span>
            <span class="token keyword">case</span> <span class="token string">'sr'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> renderPath<span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">'tr'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> renderContentTransform<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 渲染path元素</span>
    <span class="token keyword">function</span> <span class="token function">renderPath</span><span class="token punctuation">(</span><span class="token parameter">styleData<span class="token punctuation">,</span> itemData<span class="token punctuation">,</span> isFirstFrame</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> j<span class="token punctuation">,</span> jLen<span class="token punctuation">,</span>pathStringTransformed<span class="token punctuation">,</span>redraw<span class="token punctuation">,</span>pathNodes<span class="token punctuation">,</span>l<span class="token punctuation">,</span> lLen <span class="token operator">=</span> itemData<span class="token punctuation">.</span>styles<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">var</span> lvl <span class="token operator">=</span> itemData<span class="token punctuation">.</span>lvl<span class="token punctuation">;</span>
        <span class="token keyword">var</span> paths<span class="token punctuation">,</span> mat<span class="token punctuation">,</span> props<span class="token punctuation">,</span> iterations<span class="token punctuation">,</span> k<span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>l<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>l<span class="token operator">&lt;</span>lLen<span class="token punctuation">;</span>l<span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            redraw <span class="token operator">=</span> itemData<span class="token punctuation">.</span>sh<span class="token punctuation">.</span>_mdf <span class="token operator">||</span> isFirstFrame<span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>itemData<span class="token punctuation">.</span>styles<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">.</span>lvl <span class="token operator">&lt;</span> lvl<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 设置transform等属性</span>
                mat <span class="token operator">=</span> _matrixHelper<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                iterations <span class="token operator">=</span> lvl <span class="token operator">-</span> itemData<span class="token punctuation">.</span>styles<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">.</span>lvl<span class="token punctuation">;</span>
                k <span class="token operator">=</span> itemData<span class="token punctuation">.</span>transformers<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>redraw <span class="token operator">&amp;&amp;</span> iterations <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    redraw <span class="token operator">=</span> itemData<span class="token punctuation">.</span>transformers<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>mProps<span class="token punctuation">.</span>_mdf <span class="token operator">||</span> redraw<span class="token punctuation">;</span>
                    iterations <span class="token operator">--</span><span class="token punctuation">;</span>
                    k <span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>redraw<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    iterations <span class="token operator">=</span> lvl <span class="token operator">-</span> itemData<span class="token punctuation">.</span>styles<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">.</span>lvl<span class="token punctuation">;</span>
                    k <span class="token operator">=</span> itemData<span class="token punctuation">.</span>transformers<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                    <span class="token keyword">while</span><span class="token punctuation">(</span>iterations <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        props <span class="token operator">=</span> itemData<span class="token punctuation">.</span>transformers<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>mProps<span class="token punctuation">.</span>v<span class="token punctuation">.</span>props<span class="token punctuation">;</span>
                        mat<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>props<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>props<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>props<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>props<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>props<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>props<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>props<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>props<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>props<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>props<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>props<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>props<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">,</span>props<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span>props<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span>props<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span>props<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        iterations <span class="token operator">--</span><span class="token punctuation">;</span>
                        k <span class="token operator">--</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                mat <span class="token operator">=</span> _identityMatrix<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            paths <span class="token operator">=</span> itemData<span class="token punctuation">.</span>sh<span class="token punctuation">.</span>paths<span class="token punctuation">;</span>
            jLen <span class="token operator">=</span> paths<span class="token punctuation">.</span>_length<span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>redraw<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 设置path的d的值，即路径绘制形状</span>
                pathStringTransformed <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>jLen<span class="token punctuation">;</span>j<span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    pathNodes <span class="token operator">=</span> paths<span class="token punctuation">.</span>shapes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>pathNodes <span class="token operator">&amp;&amp;</span> pathNodes<span class="token punctuation">.</span>_length<span class="token punctuation">)</span><span class="token punctuation">{</span>
                        pathStringTransformed <span class="token operator">+=</span> <span class="token function">buildShapeString</span><span class="token punctuation">(</span>pathNodes<span class="token punctuation">,</span> pathNodes<span class="token punctuation">.</span>_length<span class="token punctuation">,</span> pathNodes<span class="token punctuation">.</span>c<span class="token punctuation">,</span> mat<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                itemData<span class="token punctuation">.</span>caches<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">=</span> pathStringTransformed<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                pathStringTransformed <span class="token operator">=</span> itemData<span class="token punctuation">.</span>caches<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            itemData<span class="token punctuation">.</span>styles<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">.</span>d <span class="token operator">+=</span> pathStringTransformed<span class="token punctuation">;</span>
            itemData<span class="token punctuation">.</span>styles<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">.</span>_mdf <span class="token operator">=</span> redraw <span class="token operator">||</span> itemData<span class="token punctuation">.</span>styles<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">.</span>_mdf<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div><h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>网上大佬整理的流程图</p> <p>参考：</p> <p><a href="https://imweb.io/topic/5b2b129e61340cbe5576ca44" target="_blank" rel="noopener noreferrer">lottie系列文章<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://juejin.im/post/5b62e2bae51d4534c34a65e3" target="_blank" rel="noopener noreferrer">Lottie - 轻松实现复杂的动画效果<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="http://ivanfan.site/2018/07/01/Lottie%E5%8A%A8%E7%94%BB/" target="_blank" rel="noopener noreferrer">Lottie 动画原理剖析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://www.codercto.com/a/54159.html" target="_blank" rel="noopener noreferrer">Lottie Web SVG 动画源码浅析以及对应原生实现<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://zhuanlan.zhihu.com/p/38140917" target="_blank" rel="noopener noreferrer">Lottie原理与源码解析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/2019-12-24-create-react-app.html" class="prev">create-react-app 源码分析</a></span> <span class="next"><a href="/blog/2020-06-30-vue源码.html">Vue2源码解析</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.4d237ac1.js" defer></script><script src="/assets/js/2.a060ff2c.js" defer></script><script src="/assets/js/88.0763a6b6.js" defer></script>
  </body>
</html>
